Version 4.1
SHEET 1 2824 912
WIRE 2656 -512 2640 -512
WIRE 2752 -512 2720 -512
WIRE 2640 -432 2640 -512
WIRE 2640 -432 2592 -432
WIRE 2656 -432 2640 -432
WIRE 2752 -432 2752 -512
WIRE 2752 -432 2736 -432
WIRE 2784 -432 2752 -432
WIRE 2800 -432 2784 -432
WIRE 2592 -400 2592 -432
WIRE 1808 -384 1776 -384
WIRE 1856 -384 1808 -384
WIRE 1984 -384 1920 -384
WIRE 2032 -384 1984 -384
WIRE 592 -368 560 -368
WIRE 688 -368 656 -368
WIRE 784 -368 688 -368
WIRE 944 -368 848 -368
WIRE 1856 -352 1856 -368
WIRE 2592 -288 2592 -320
WIRE 496 -272 464 -272
WIRE 560 -272 560 -368
WIRE 560 -272 496 -272
WIRE 576 -272 560 -272
WIRE 688 -272 688 -368
WIRE 688 -272 656 -272
WIRE 720 -272 688 -272
WIRE 848 -272 784 -272
WIRE 944 -272 944 -368
WIRE 944 -272 928 -272
WIRE 1904 -272 1904 -288
WIRE 1904 -240 1904 -272
WIRE 1808 -224 1792 -224
WIRE 1872 -224 1808 -224
WIRE 2032 -224 2000 -224
WIRE 2064 -224 2032 -224
WIRE 1984 -208 1936 -208
WIRE 2064 -208 1984 -208
WIRE 2208 -208 2128 -208
WIRE 2240 -208 2208 -208
WIRE 688 -192 688 -272
WIRE 816 -192 688 -192
WIRE 1696 -192 1600 -192
WIRE 1792 -192 1776 -192
WIRE 1872 -192 1792 -192
WIRE 2064 -192 2032 -192
WIRE 944 -176 944 -272
WIRE 944 -176 880 -176
WIRE 1056 -176 944 -176
WIRE 1104 -176 1056 -176
WIRE 2064 -176 2048 -176
WIRE 816 -160 640 -160
WIRE 2048 -160 2048 -176
WIRE 2064 -160 2048 -160
WIRE 1600 -144 1600 -192
WIRE 1904 -144 1904 -176
WIRE 2048 -144 2048 -160
WIRE 2080 -144 2080 -160
WIRE 2080 -144 2048 -144
WIRE 640 -128 640 -160
WIRE 2080 -128 2080 -144
WIRE 0 -112 -48 -112
WIRE 96 -112 64 -112
WIRE 1792 -96 1792 -192
WIRE 1808 -96 1792 -96
WIRE 1904 -96 1888 -96
WIRE 1984 -96 1984 -208
WIRE 1984 -96 1968 -96
WIRE -48 -16 -48 -112
WIRE -48 -16 -80 -16
WIRE -16 -16 -48 -16
WIRE 96 -16 96 -112
WIRE 96 -16 64 -16
WIRE 144 -16 96 -16
WIRE 320 -16 144 -16
WIRE 368 -16 320 -16
WIRE 640 -16 640 -48
WIRE 1600 -16 1600 -64
WIRE -960 0 -1072 0
WIRE -784 0 -896 0
WIRE 1712 0 1680 0
WIRE 1744 0 1712 0
WIRE 144 16 144 -16
WIRE 1744 16 1744 0
WIRE 368 32 368 -16
WIRE 1712 32 1680 32
WIRE 1744 32 1712 32
WIRE 1872 32 1856 32
WIRE 1920 32 1872 32
WIRE 2032 32 2032 -192
WIRE 2032 32 2016 32
WIRE 2080 32 2064 32
WIRE 2128 32 2080 32
WIRE 1744 48 1728 48
WIRE -304 64 -304 48
WIRE 1728 64 1728 48
WIRE 1744 64 1728 64
WIRE 1824 64 1808 64
WIRE 1728 80 1728 64
WIRE 1744 80 1728 80
WIRE 1824 80 1792 80
WIRE 1920 80 1888 80
WIRE 2080 80 2064 80
WIRE 2128 80 2080 80
WIRE 2256 80 2240 80
WIRE -1072 96 -1072 0
WIRE -1040 96 -1072 96
WIRE -912 96 -976 96
WIRE -784 96 -784 0
WIRE -784 96 -832 96
WIRE -304 96 -304 64
WIRE -304 96 -368 96
WIRE 1728 96 1728 80
WIRE 1760 96 1760 80
WIRE 1760 96 1728 96
WIRE 1824 96 1808 96
WIRE -304 112 -304 96
WIRE 144 112 144 80
WIRE 272 112 256 112
WIRE 320 112 272 112
WIRE 1760 112 1760 96
WIRE 1808 112 1808 96
WIRE 1824 112 1808 112
WIRE -368 128 -368 96
WIRE -80 128 -80 -16
WIRE 1808 128 1808 112
WIRE 1824 128 1808 128
WIRE -1232 144 -1232 128
WIRE -928 144 -928 128
WIRE -560 144 -560 128
WIRE 1808 144 1808 128
WIRE 1840 144 1840 128
WIRE 1840 144 1808 144
WIRE -560 160 -560 144
WIRE 1840 160 1840 144
WIRE -928 176 -928 144
WIRE -640 176 -672 176
WIRE -592 176 -640 176
WIRE 368 176 368 128
WIRE 432 176 368 176
WIRE 544 176 432 176
WIRE 624 176 544 176
WIRE 768 176 704 176
WIRE 896 176 768 176
WIRE 1040 176 896 176
WIRE 1200 176 1040 176
WIRE 1424 176 1200 176
WIRE 1472 176 1424 176
WIRE -1120 192 -1136 192
WIRE -1072 192 -1072 96
WIRE -1072 192 -1120 192
WIRE -960 192 -1072 192
WIRE -512 192 -528 192
WIRE -464 192 -512 192
WIRE -432 192 -464 192
WIRE 1792 192 1792 80
WIRE 2256 192 2256 80
WIRE 2256 192 1792 192
WIRE -1232 208 -1232 144
WIRE -832 208 -896 208
WIRE -784 208 -784 96
WIRE -784 208 -832 208
WIRE -768 208 -784 208
WIRE -672 208 -688 208
WIRE -592 208 -672 208
WIRE -368 208 -368 192
WIRE -304 208 -304 192
WIRE -304 208 -368 208
WIRE 368 208 368 176
WIRE 1040 208 1040 176
WIRE 1200 208 1200 176
WIRE 1472 208 1472 176
WIRE 1472 208 1424 208
WIRE -960 224 -1072 224
WIRE -304 224 -304 208
WIRE 544 224 544 176
WIRE 768 224 768 176
WIRE 896 224 896 176
WIRE 1472 224 1472 208
WIRE -1072 256 -1072 224
WIRE -672 256 -672 208
WIRE -656 256 -672 256
WIRE -512 256 -512 192
WIRE -512 256 -576 256
WIRE 272 288 256 288
WIRE 320 288 272 288
WIRE 1424 320 1424 208
WIRE 1472 320 1472 304
WIRE 1472 320 1424 320
WIRE -304 336 -304 304
WIRE -80 336 -80 208
WIRE 368 336 368 304
WIRE 544 336 544 288
WIRE 768 336 768 288
WIRE 896 336 896 288
WIRE 1040 336 1040 272
WIRE 1072 336 1040 336
WIRE 1168 336 1152 336
WIRE 1200 336 1200 288
WIRE 1200 336 1168 336
WIRE 1472 336 1472 320
WIRE -304 352 -304 336
WIRE -1232 368 -1232 288
WIRE -1072 368 -1072 336
WIRE -928 368 -928 240
WIRE -560 368 -560 224
WIRE 1200 368 1200 336
WIRE 1200 464 1200 448
WIRE 1472 464 1472 416
WIRE -800 560 -800 528
WIRE -800 624 -800 560
WIRE -800 752 -800 704
FLAG -80 336 0
FLAG 368 336 0
FLAG 432 176 SW
FLAG 768 336 0
FLAG 144 112 0
FLAG 320 -16 V_in
FLAG 1472 464 0
FLAG 1424 176 V_out
FLAG 272 112 HG
FLAG 272 288 LG
FLAG -304 336 SW
FLAG -304 64 HG
FLAG -800 752 0
FLAG -800 560 ramp
FLAG -1232 368 0
FLAG -928 368 0
FLAG -1072 368 0
FLAG -560 368 0
FLAG -640 176 ramp
FLAG -464 192 V_HS
FLAG -1120 192 FB
FLAG 1200 464 0
FLAG 1168 336 FB
FLAG -832 208 comp
FLAG 640 -16 0
FLAG 496 -272 V_in
FLAG 1056 -176 reg_source
FLAG 896 336 0
FLAG 2784 -432 LG
FLAG 1904 -144 0
FLAG -1232 144 5V
FLAG -928 144 5V
FLAG -560 144 5V
FLAG 1904 -272 5V
FLAG 1808 -224 SW
FLAG 1600 -16 0
FLAG 2592 -288 0
FLAG 1856 -352 0
FLAG 1808 -384 V_HS
FLAG 544 336 0
FLAG 2080 -128 0
FLAG 1920 112 0
FLAG 1984 -384 V_HS_n
FLAG 2032 -224 V_HS_n
FLAG 2128 112 0
FLAG 2208 -208 V_LS
FLAG 1968 -80 0
FLAG 1872 32 V_HS
FLAG 1760 112 0
FLAG 1712 0 V_HS
FLAG 1712 32 V_LS
FLAG 1840 160 0
FLAG 2080 32 V_HS
FLAG 2080 80 V_LS
SYMBOL ind -32 0 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {1/f_sw}
SYMATTR SpiceLine Rser={1e5/f_sw}
SYMBOL schottky 64 -128 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value DampD
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL nmos 320 32 R0
SYMATTR InstName M1
SYMATTR Value BSC0904NSI
SYMBOL ind 608 192 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value {L_s}
SYMATTR SpiceLine Rser={R_L_s}
SYMBOL cap 128 16 R0
SYMATTR InstName C1
SYMATTR Value {C_in}
SYMATTR SpiceLine Rser={R_C_in}
SYMBOL cap 752 224 R0
SYMATTR InstName C2
SYMATTR Value {C_out}
SYMATTR SpiceLine Rser={R_C_out}
SYMBOL bv -304 208 R0
SYMATTR InstName B1
SYMATTR Value V=V(V_HS)
SYMBOL res -320 96 R0
SYMATTR InstName R2
SYMATTR Value 4.7
SYMBOL voltage -800 608 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0.1 5.1 0 {0.5/f_sw} {0.45/f_sw} 0 {1/f_sw})
SYMBOL voltage -1232 192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PWL(0 0 10u 0 10.1u 5)
SYMBOL voltage -1072 240 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=1k Cpar={sqrt(L_s*C_out)/1k}
SYMATTR InstName V4
SYMATTR Value 1
SYMBOL cap -976 80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value {C_1}
SYMBOL OpAmps\\UniversalOpAmp2 -560 192 R0
SYMATTR InstName U2
SYMATTR Value2 Avol=10G GBW=10G Slew=10G
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=1000Meg
SYMBOL res 1184 192 R0
SYMATTR InstName R4
SYMATTR Value {R_1}
SYMBOL res 1184 352 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL cap 1024 208 R0
SYMATTR InstName C4
SYMATTR Value {C_2}
SYMBOL res -672 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res -560 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL cap -896 -16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value {C_3}
SYMBOL res -816 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value {R_2}
SYMBOL OpAmps\\UniversalOpAmp3 -928 208 R0
SYMATTR InstName U1
SYMATTR Value2 Avol=10Meg GBW=10Meg Slew=10Meg
SYMATTR SpiceLine Ilimit=25m Rail=0 Vos=0 Phimargin=60
SYMBOL res 1168 320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {R_3}
SYMBOL res 1456 320 R0
SYMATTR InstName R1
SYMATTR Value {R_L}
SYMBOL voltage 640 -144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR InstName V1
SYMATTR Value {V_bus}
SYMBOL OpAmps\\UniversalOpAmp 848 -176 R0
SYMATTR InstName U3
SYMBOL cap 784 -288 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value {1u/sqrt(f_sw)}
SYMBOL res 672 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 22k
SYMBOL res 944 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL cap 656 -384 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value {0.1u/sqrt(f_sw)}
SYMBOL cap 848 -384 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value {1u/sqrt(f_sw)}
SYMBOL bv -80 112 R0
SYMATTR InstName B2
SYMATTR Value V=V(reg_source)
SYMBOL cap 880 224 R0
SYMATTR InstName C9
SYMATTR Value {C_out/5}
SYMATTR SpiceLine Rser={sqrt(5/f_sw/C_out)}
SYMBOL current 1472 224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value PULSE({0.1*V_set/R_L} {V_set/R_L} {150/f_sw} 1u 1u {150/f_sw} {300/f_sw})
SYMBOL nmos 320 208 R0
SYMATTR InstName M2
SYMATTR Value BSC0904NSI
SYMBOL OpAmps\\UniversalOpAmp2 1904 -208 R0
SYMATTR InstName U4
SYMATTR Value2 Avol=10Meg GBW=10G Slew=10G
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=1000Meg
SYMBOL res 2752 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 4.7
SYMBOL res 1792 -208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL voltage 1600 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value -0.265
SYMBOL res 1904 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 19k
SYMBOL bv 2592 -416 R0
SYMATTR InstName B3
SYMATTR Value V=V(V_LS)
SYMBOL diode -384 128 R0
SYMATTR InstName D2
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL diode 2720 -528 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL Digital\\inv 1856 -448 R0
WINDOW 3 8 104 Invisible 2
SYMATTR InstName A2
SYMATTR Value Vhigh=5,Ref=2.5
SYMBOL diode 528 288 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL Digital\\srflop 2176 -16 R0
WINDOW 3 -40 28 Invisible 2
SYMATTR InstName A3
SYMATTR Value Vhigh=5,Ref=2.5
SYMBOL Digital\\srflop 1968 -16 R0
WINDOW 3 -40 28 Invisible 2
SYMATTR InstName A4
SYMATTR Value Vhigh=5,Ref=2.5
SYMBOL Digital\\and 2096 -256 R0
WINDOW 3 16 52 Invisible 2
SYMATTR InstName A5
SYMATTR Value Vhigh=5,Ref=2.5
SYMBOL Digital\\or 1776 -16 R0
WINDOW 3 -8 128 Invisible 2
SYMATTR InstName A1
SYMATTR Value Vhigh=5,Ref=2.5
SYMBOL Digital\\and 1856 32 R0
WINDOW 3 16 52 Invisible 2
SYMATTR InstName A7
SYMATTR Value Vhigh=5,Ref=2.5
SYMBOL Digital\\buf1 1968 -160 M0
WINDOW 3 8 104 Invisible 2
SYMATTR InstName A6
SYMATTR Value Vhigh=5,Ref=2.5
TEXT 56 472 Left 2 !.tran 0 {600/f_sw} {500/f_sw} startup
TEXT 56 528 Left 2 !.param f_sw=500k V_bus=12 V_set=5 R_L=1k
TEXT 56 560 Left 2 !.param C_in=10u R_C_in=5m C_out=40u R_C_out=3m L_s=4.7u R_L_s=5m
TEXT 56 608 Left 2 !.meas P_in AVG -V(V_in)*I(B2)
TEXT 56 640 Left 2 !.meas P_out AVG V(V_out)*I(R1)
TEXT 56 672 Left 2 !.meas V_out_pp PP V(V_out)
TEXT 56 440 Left 2 !.model DampD D(Ron=1m,Roff=1Meg,Vfwd=0.2)
TEXT 56 808 Left 2 !.options reltol=0.0001
TEXT 56 704 Left 2 !.meas Efficiency PARAM P_out/P_in
TEXT 992 616 Left 2 !.param w_0=1/sqrt(L_s*C_out) z_esr=1/(C_out*R_C_out)
TEXT 992 648 Left 2 !.param K_I=min(6.28*f_sw/10,w_0*5) w_z1=w_0 w_z2=w_0 w_p1=min(K_I,z_esr*5) w_p2=max(K_I,z_esr*5)
TEXT 992 680 Left 2 !.param R_1=10k*(V_set-1) C_3=w_z1/(w_p2*R_1*K_I) C_1=1/(R_1*K_I)-C_3 R_2=1/(w_z1*C_1) C_2={(1/w_z2-1/w_p1)/R_1} R_3=1/(w_p1*C_2)
TEXT 56 736 Left 2 !.meas I_L_pk MAX I(L2)
